#!/usr/bin/env bash
# Evalchemy evals for instilloracle SFT 4B experiments + Qwen3-4B baseline.
# Generated by Claude from claude/results.md instructions.
# Each command evaluates ALL benchmarks (AIME24, AIME25, AMC23, HMMT, MATH500).

set -euo pipefail

# =============================================================================
# Baseline: Qwen/Qwen3-4B (no --experiment; name derived from model path)
# =============================================================================
python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --checkpoint "Qwen/Qwen3-4B" --force_run_failed true

# =============================================================================
# exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math (6 checkpoints)
# =============================================================================
python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-1000/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-1500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-2000/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-2500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_mixtureofthoughts_math-263ee5/hf/step-2929/" \
    --force_run_failed true

# =============================================================================
# exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought (3 checkpoints)
# Picked -4646af over -a9142d (more steps in hf/)
# =============================================================================
python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought-4646af/hf/step-500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought-4646af/hf/step-1000/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_temp_instilloracle_sft_qwen3_4b_selfinstill_mixtureofthought-4646af/hf/step-1409/" \
    --force_run_failed true

# =============================================================================
# exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math (4 checkpoints)
# =============================================================================
python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math-3d6ce3/hf/step-500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math-3d6ce3/hf/step-1000/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math-3d6ce3/hf/step-1500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_selfinstill_openthoughts4_math-3d6ce3/hf/step-1738/" \
    --force_run_failed true

# =============================================================================
# exp_instilloracle_sft_qwen3_4b_openthoughts4_math (4 checkpoints)
# =============================================================================
python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_openthoughts4_math-d5c87e/hf/step-500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_openthoughts4_math-d5c87e/hf/step-1000/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_openthoughts4_math-d5c87e/hf/step-1500/" \
    --force_run_failed true

python lib/marin/src/marin/run/ray_run.py --no_wait --extra eval,vllm \
    --env_vars HF_TOKEN ${HF_TOKEN} \
    --env_vars WANDB_API_KEY ${WANDB_API_KEY} \
    --env_vars WANDB_ENTITY stanford-mercury \
    --env_vars WANDB_PROJECT instill-eval \
    -- python experiments/evals/exp_evalchemy_eval.py \
    --experiment "exp_instilloracle_sft_qwen3_4b_openthoughts4_math" \
    --checkpoint "gs://marin-us-central1/checkpoints/exp_instilloracle_sft_qwen3_4b_openthoughts4_math-d5c87e/hf/step-1872/" \
    --force_run_failed true

# =============================================================================
# SKIPPED: exp_instilloracle_sft_qwen3_4b_selfinstill_mot_math_45k_n1_uq1_round1
# GCS folder: exp_instilloracle_sft_qwen3_4b_selfinstill_mot_math_45k_n1_uq1_r-bb75b3
# Reason: No HF-format checkpoints found (only raw checkpoint at step-7).
# =============================================================================
