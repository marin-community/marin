# Iris production configuration for Marin cluster
# Usage: uv run iris cluster --config=examples/marin.yaml start

platform:
  label_prefix: iris
  gcp:
    project_id: hai-gcp-models
    zones: [europe-west4-b]

defaults:
  timeouts:
    boot_timeout:
      milliseconds: 300000
    init_timeout:
      milliseconds: 600000
    ssh_poll_interval:
      milliseconds: 5000
  autoscaler:
    evaluation_interval:
      milliseconds: 10000
    requesting_timeout:
      milliseconds: 120000
    scale_up_delay:
      milliseconds: 60000
    scale_down_delay:
      milliseconds: 300000
  bootstrap:
    docker_image: europe-west4-docker.pkg.dev/hai-gcp-models/marin/iris-worker:latest
    worker_port: 10001

controller:
  image: europe-west4-docker.pkg.dev/hai-gcp-models/marin/iris-controller:latest
  bundle_prefix: gs://marin-us-central2/tmp/iris/bundles
  gcp:
    zone: europe-west4-b
    machine_type: e2-standard-4
    port: 10000

scale_groups:
  tpu_v5e_16:
    accelerator_type: tpu
    accelerator_variant: v5litepod-16
    num_vms: 4
    resources:
      cpu: 128
      ram: 128GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 1
    max_slices: 4
    priority: 200
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-16
      num_vms: 4
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite
    worker:
      attributes:
        region: "europe-west4"
        preemptible: "true"
  tpu_v5e_32:
    accelerator_type: tpu
    accelerator_variant: v5litepod-32
    num_vms: 8
    resources:
      cpu: 128
      ram: 128GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 1
    max_slices: 16
    priority: 100
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-32
      num_vms: 8
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite
    worker:
      attributes:
        region: "europe-west4"
        preemptible: "true"
