# Iris smoke-test configuration
# Usage: uv run python scripts/smoke-test.py

platform:
  label_prefix: smoke
  gcp:
    project_id: hai-gcp-models

defaults:
  autoscaler:
    evaluation_interval:
      milliseconds: 10000
    scale_up_delay:
      milliseconds: 60000
    scale_down_delay:
      milliseconds: 300000
  worker:
    docker_image: ghcr.io/marin-community/iris-worker:latest
    default_task_image: ghcr.io/marin-community/iris-task:latest
    port: 10001

storage:
  bundle_prefix: gs://marin-us-central2/tmp/iris/bundles

controller:
  image: ghcr.io/marin-community/iris-controller:latest
  gcp:
    zone: europe-west4-b
    machine_type: e2-standard-4
    port: 10000

scale_groups:
  # Low-priority fallback CPU VM group for non-preemptible scheduling tests.
  # Intentionally not default: selected only when jobs constrain preemptible=false.
  cpu_vm_e2_standard_4_ondemand:
    zones: [europe-west4-b]
    accelerator_type: cpu
    num_vms: 1
    resources:
      cpu: 4
      ram: 16GB
      disk: 100GB
      tpu_count: 0
      gpu_count: 0
    min_slices: 0
    max_slices: 2
    priority: 1000
    slice_template:
      accelerator_type: cpu
      preemptible: false
      gcp:
        mode: GCP_SLICE_MODE_VM
        machine_type: e2-standard-4
    worker:
      attributes:
        preemptible: "false"

  tpu_v5e_16:
    zones: [europe-west4-b, us-west4-a]
    accelerator_type: tpu
    accelerator_variant: v5litepod-16
    num_vms: 4
    resources:
      cpu: 128
      ram: 128GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 1
    max_slices: 4
    priority: 100
    slice_template:
      accelerator_variant: v5litepod-16
      preemptible: true
      gcp:
        runtime_version: v2-alpha-tpuv5-lite
    worker:
      attributes:
        preemptible: "true"
  tpu_v5e_32:
    zones: [europe-west4-b, us-west4-a]
    accelerator_type: tpu
    accelerator_variant: v5litepod-32
    num_vms: 8
    resources:
      cpu: 128
      ram: 128GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 0
    max_slices: 16
    priority: 200
    slice_template:
      accelerator_variant: v5litepod-32
      preemptible: true
      gcp:
        runtime_version: v2-alpha-tpuv5-lite
    worker:
      attributes:
        preemptible: "true"
