# Iris demo configuration
# Multiple scale groups for realistic testing with diverse scenarios
# Uses env var for controller address (external controller)

platform:
  label_prefix: iris
  gcp:
    project_id: hai-gcp-models

defaults:
  timeouts:
    boot_timeout:
      milliseconds: 300000
    init_timeout:
      milliseconds: 600000
    ssh_poll_interval:
      milliseconds: 5000
  autoscaler:
    evaluation_interval:
      milliseconds: 10000
    requesting_timeout:
      milliseconds: 120000
    scale_up_delay:
      milliseconds: 60000
    scale_down_delay:
      milliseconds: 300000
  bootstrap:
    docker_image: europe-west4-docker.pkg.dev/hai-gcp-models/marin/iris-worker:latest
    worker_port: 10001
    controller_address: "${IRIS_CONTROLLER_ADDRESS}"

controller:
  image: europe-west4-docker.pkg.dev/hai-gcp-models/marin/iris-controller:latest
  bundle_prefix: gs://marin-us-central2/tmp/iris/bundles
  gcp:
    zone: europe-west4-b
    machine_type: n2-standard-4
    port: 10000

scale_groups:
  # Active scale group with capacity
  tpu_v5e_4:
    accelerator_type: tpu
    accelerator_variant: v5litepod-4
    num_vms: 1
    resources:
      cpu: 64
      ram: 64GB
      disk: 500GB
      tpu_count: 4
      gpu_count: 0
    min_slices: 2
    max_slices: 10
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-4
      num_vms: 1
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite

  # Scale group with some capacity but lower limits
  tpu_v5e_16:
    accelerator_type: tpu
    accelerator_variant: v5litepod-16
    num_vms: 4
    resources:
      cpu: 128
      ram: 128GB
      disk: 1TB
      tpu_count: 8
      gpu_count: 0
    min_slices: 1
    max_slices: 5
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-16
      num_vms: 4
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite

  # Zero quota group - simulates quota exhaustion
  tpu_v6e_256_no_quota:
    accelerator_type: tpu
    accelerator_variant: v6e-256
    num_vms: 64
    resources:
      cpu: 256
      ram: 256GB
      disk: 2TB
      tpu_count: 8
      gpu_count: 0
    min_slices: 0
    max_slices: 0  # ZERO MAX - simulates no quota available
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v6e-256
      num_vms: 64
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv6e

  # Disabled group - min and max both zero
  gpu_disabled:
    accelerator_type: gpu
    accelerator_variant: a100-40gb
    num_vms: 1
    resources:
      cpu: 64
      ram: 128GB
      disk: 1TB
      tpu_count: 0
      gpu_count: 1
    min_slices: 0
    max_slices: 0
    slice_template:
      accelerator_type: gpu
      accelerator_variant: a100-40gb
      num_vms: 1
      preemptible: false
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite

  # Multi-zone is achieved by creating separate scaling groups per zone.
  tpu_v5e_8_zone_a:
    accelerator_type: tpu
    accelerator_variant: v5litepod-8
    num_vms: 1
    resources:
      cpu: 96
      ram: 96GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 0
    max_slices: 1
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-8
      num_vms: 1
      preemptible: true
      gcp:
        zone: europe-west4-a
        runtime_version: v2-alpha-tpuv5-lite

  tpu_v5e_8_zone_b:
    accelerator_type: tpu
    accelerator_variant: v5litepod-8
    num_vms: 1
    resources:
      cpu: 96
      ram: 96GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 0
    max_slices: 1
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-8
      num_vms: 1
      preemptible: true
      gcp:
        zone: europe-west4-b
        runtime_version: v2-alpha-tpuv5-lite

  tpu_v5e_8_zone_c:
    accelerator_type: tpu
    accelerator_variant: v5litepod-8
    num_vms: 1
    resources:
      cpu: 96
      ram: 96GB
      disk: 1TB
      tpu_count: 4
      gpu_count: 0
    min_slices: 0
    max_slices: 1
    slice_template:
      accelerator_type: tpu
      accelerator_variant: v5litepod-8
      num_vms: 1
      preemptible: true
      gcp:
        zone: europe-west4-c
        runtime_version: v2-alpha-tpuv5-lite
